#!/bin/bash

set -euo pipefail

log_message() {
    echo -e "\n$1\n"
}

log_list_item() {
    echo -e "\t$1"
}

# Source of truth for all deps
deps=(
    # System
    "rg"
    "tmux"
    "fzf"
    "glow"
    "nvim"
    "lua"
    "node"
    "python3"

    # Lang servers
    "pyright"
    "tsserver"
    "lua-language-server"
    "vscode-css-language-server"
    "vscode-html-language-server"
    "vscode-json-language-server"

    # JS/TS
    "n"
    "npm"
    "eslint"

    # Python
    "pip"
    "flake8"

    # Misc.
    "hadolint"
    "shellcheck"
    "proselint"
    "sqlfluff"
)

# Collect uninstalled dependencies
uninstalled=()
for dep in "${deps[@]}"; do
    if [[ ! "$(command -v "$dep")" ]]; then
        uninstalled+=("$dep")
    fi
done

# If missing dependencies, warn and exit
if (( ${#uninstalled[@]} )); then
    log_message "Missing in PATH:"
    for dep in "${uninstalled[@]}"; do
        log_list_item "$dep"
    done; echo; exit
fi

log_message "Dependencies satisfied"
